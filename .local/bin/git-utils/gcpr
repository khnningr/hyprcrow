#!/usr/bin/env bash

set -euo pipefail

source login.sh
source dir-repos.sh
source local-dir-repos.sh

gum style --border normal \
	--margin "1" \
	--padding "1 2" \
	--border-foreground 212 "Actualizar $(gum style --foreground 212 'Repositorios')"

actualizar_repositorio() {

	local REPOSITORIO="$1"

	echo -e "\n$REPOSITORIO"
	cd "$REPOSITORIO" || return 1

	git pull

	source commit.sh "${REPOSITORIO}"
	source push.sh
}

mapfile -t ELEGIR_REPOS < <(printf '%s\n' "${repositorios[@]}" |
	gum choose --no-limit \
		--header 'Seleccione los repositorios para actualizar: ')

for REPOSITORIO in "${ELEGIR_REPOS[@]}"; do
	if [[ -n "$REPOSITORIO" ]]; then
		actualizar_repositorio "$REPOSITORIO"
	fi
done
