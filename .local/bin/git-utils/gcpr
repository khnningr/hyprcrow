#!/usr/bin/env bash

set -euo pipefail

source dependencias.sh
source login.sh


REPOS=(
	"${HOME}/hyprcrow/"
	"${HOME}/Wallpapers/"
	"${HOME}/kh-home"
)

actualizar_repositorio() {

	local REPOSITORIO="$1"

	echo -e "\n$REPOSITORIO"
	cd "$REPOSITORIO" || return 1

	git pull

	if [[ -z $(git status --porcelain) ]]; then
		echo "No hay cambios en $REPOSITORIO, omitiendo commit"
		return 0
	fi

	git add .

	COMMIT=$(gum input --placeholder "Mensaje del commit" --prompt "Commit> ")

	if [[ -z "$COMMIT" ]]; then
		COMMIT=$(date +"%Y/%m/%d a las %I:%M %p")
	fi

	if [[ -n "$COMMIT" ]]; then
		git commit -a -m "$COMMIT"
		git push -u origin main
		echo "$REPOSITORIO actualizado correctamente."
	else
		echo "Ã— Commit cancelado para $REPOSITORIO"
	fi
}

mapfile -t ELEGIR_REPOS < <(printf '%s\n' "${REPOS[@]}" |
	gum choose --no-limit \
		--header 'Seleccione los repositorios para actualizar: ')

for REPOSITORIO in "${ELEGIR_REPOS[@]}"; do
	if [[ -n "$REPOSITORIO" ]]; then
		actualizar_repositorio "$REPOSITORIO"
	fi
done
